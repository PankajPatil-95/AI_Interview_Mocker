{% extends 'base.html' %}
{% block title %}Dashboard | MockMate{% endblock %}
{% block content %}
<div class="container py-5" style="max-width: 900px;">
  <div class="mb-4 text-center">
    <h1 class="text-primary fw-bold">Welcome, {{ profile.full_name|default:user.username }}!</h1>
    <p class="lead">Your personalized interview dashboard</p>
    <div class="small text-muted">
      {% if profile %}
        Role: {{ profile.role|default:'—' }} &middot; Experience: {{ profile.years_experience|default:'—' }} years
      {% else %}
        No profile details available.
      {% endif %}
    </div>
  </div>
  <div class="row g-4 mb-4">
    <div class="col-md-6">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title">Start a Mock Interview</h5>
          <p class="card-text">Practice with AI-generated questions and get instant feedback.</p>
          <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#startInterviewModal">Start Interview</button>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title">View Results</h5>
          <p class="card-text">Review your interview performance and feedback.</p>
          <a href="/results" class="btn btn-primary">View Results</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Start Interview Modal -->
  <div class="modal fade" id="startInterviewModal" tabindex="-1" aria-labelledby="startInterviewModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <form method="post" action="/mock-interview/">
          {% csrf_token %}
          <div class="modal-header bg-primary text-white">
            <h5 class="modal-title" id="startInterviewModalLabel"><i class="bi bi-play-circle-fill me-2"></i>Configure Mock Interview</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p class="text-muted mb-4">Configure your mock interview session to generate personalized AI-powered questions tailored to your role and experience.</p>
            <div class="mb-3">
              <label for="interviewName" class="form-label fw-semibold"><i class="bi bi-person-fill me-2 text-primary"></i>Your Name</label>
              <input type="text" class="form-control" id="interviewName" name="name" value="{{ profile.full_name|default:user.username }}" required>
            </div>
            <div class="mb-3">
              <label for="interviewRole" class="form-label fw-semibold"><i class="bi bi-briefcase-fill me-2 text-primary"></i>Role/Position</label>
              <select class="form-select" id="interviewRole" name="role" required>
                <option value="">Select role</option>
                <option value="Backend Engineer" {% if profile and profile.role == 'Backend Engineer' %}selected{% endif %}>Backend Engineer</option>
                <option value="Frontend Engineer" {% if profile and profile.role == 'Frontend Engineer' %}selected{% endif %}>Frontend Engineer</option>
                <option value="Full Stack Engineer" {% if profile and profile.role == 'Full Stack Engineer' %}selected{% endif %}>Full Stack Engineer</option>
                <option value="Data Scientist" {% if profile and profile.role == 'Data Scientist' %}selected{% endif %}>Data Scientist</option>
                <option value="DevOps Engineer" {% if profile and profile.role == 'DevOps Engineer' %}selected{% endif %}>DevOps Engineer</option>
                <option value="QA / SDET" {% if profile and profile.role == 'QA / SDET' %}selected{% endif %}>QA / SDET</option>
                <option value="Product Manager" {% if profile and profile.role == 'Product Manager' %}selected{% endif %}>Product Manager</option>
                <option value="Other" {% if profile and profile.role == 'Other' %}selected{% endif %}>Other</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="interviewExp" class="form-label fw-semibold"><i class="bi bi-clock-fill me-2 text-primary"></i>Experience Level</label>
              <select class="form-select" id="interviewExp" name="experience" required>
                <option value="">Select experience level</option>
                <option value="Fresher">Fresher</option>
                <option value="Mid">Mid</option>
                <option value="Senior">Senior</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="interviewType" class="form-label fw-semibold"><i class="bi bi-tags-fill me-2 text-primary"></i>Interview Type</label>
              <select class="form-select" id="interviewType" name="interview_type" required>
                <option value="">Select type</option>
                <option value="technical">Technical</option>
                <option value="behavioral">Behavioral</option>
                <option value="mixed">Mixed</option>
              </select>
            </div>
            <input type="hidden" name="mode" value="voice">
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary px-4"><i class="bi bi-rocket-takeoff me-2"></i>Start Interview</button>
          </div>
        </form>
      </div>
    </div>
  </div>
  <div class="row g-4">
    <div class="col-md-12">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title">Recent Interviews</h5>
          <ul class="list-group list-group-flush">
            {% for interview in recent_activity %}
            <li class="list-group-item">
              <div class="d-flex justify-content-between align-items-start">
                <div class="me-3" style="flex:1; min-width:0;">
                  <div class="d-flex align-items-baseline">
                    <strong class="me-2">{{ interview.role|default:'Candidate' }}</strong>
                    <small class="text-muted">&middot; {{ interview.interview_type|default:'behavioral'|title }} Interview</small>
                  </div>
                  <div class="text-muted small">{{ interview.created_at|date:"M d, Y H:i" }}</div>

                  {% comment %} Compact feedback preview: overall score and short summary {% endcomment %}
                  <div class="mt-2 d-flex align-items-center">
                    {% if interview.overall_score %}
                      <span class="badge bg-success me-2">Score: {{ interview.overall_score }}%</span>
                    {% elif interview.grade_label %}
                      <span class="badge bg-info text-dark me-2">{{ interview.grade_label }}</span>
                    {% else %}
                      <span class="badge bg-secondary me-2">No score</span>
                    {% endif %}

                    <div class="text-truncate" style="max-width:520px;">
                      {% if interview.summary %}
                        {{ interview.summary|truncatechars:100 }}
                      {% elif interview.overall_feedback %}
                        {{ interview.overall_feedback|truncatechars:100 }}
                      {% else %}
                        <span class="text-muted">No feedback yet. View full results for details.</span>
                      {% endif %}
                    </div>
                  </div>
                </div>
                <div class="text-end ms-3">
                  <a href="/results/{{ interview.id }}" class="btn btn-sm btn-outline-primary mb-2">View</a>
                  <div>
                    <small class="text-muted">{{ interview.mode|default:'voice'|title }}</small>
                  </div>
                </div>
              </div>
            </li>
            {% empty %}
            <li class="list-group-item text-muted">No recent interviews yet.</li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>


{% endblock %}
